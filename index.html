<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales MIS Dashboard</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<style>
/* ===== EXISTING STYLES (UNCHANGED) ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;
background:linear-gradient(135deg,#0f172a,#1e293b);
color:#e2e8f0;min-height:100vh;padding:20px}
.container{max-width:1400px;margin:auto}
header{margin-bottom:30px}
h1{font-size:2.5rem;color:#fff}
.subtitle{color:#94a3b8}
.designer{color:#3b82f6;font-weight:700}

.filters{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:15px;
background:#1e293b;
padding:20px;
border-radius:12px;
margin-bottom:25px}

.filter-group label{font-size:.9rem;margin-bottom:6px}
.filter-group select{
padding:10px;
background:#0f172a;
border:2px solid #334155;
border-radius:8px;
color:#fff}

.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;margin-bottom:25px}

.kpi-card{
padding:25px;border-radius:12px;
background:linear-gradient(135deg,#3b82f6,#2563eb)}

.kpi-card.purple{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}
.kpi-card.pink{background:linear-gradient(135deg,#ec4899,#db2777)}
.kpi-card.orange{background:linear-gradient(135deg,#f59e0b,#d97706)}

.kpi-label{font-size:.9rem}
.kpi-value{font-size:2rem;font-weight:700}

.charts-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(450px,1fr));
gap:20px}

.chart-card{
background:#1e293b;
padding:20px;border-radius:12px}

.chart-card.full-width{grid-column:1/-1}
.chart-title{font-size:1.2rem;margin-bottom:10px}
.chart-container{height:260px}
.chart-container.tall{height:360px}

.error{
padding:15px;
background:#1e293b;
color:#ef4444;
border-radius:8px;
text-align:center;
font-weight:600}
</style>
</head>

<body>
<div class="container">

<header>
<h1>ðŸ“Š TVM-SALES Dashboard</h1>
<p class="subtitle">Sales Analytics and Insights</p>
<p class="designer">Designed by Prasad K</p>
</header>

<div id="dashboard">

<!-- ================= KPI ================= -->
<div class="kpi-grid">
<div class="kpi-card"><div class="kpi-label">Total Revenue</div><div class="kpi-value" id="totalRevenue">â‚¹0</div></div>
<div class="kpi-card purple"><div class="kpi-label">Customers</div><div class="kpi-value" id="totalCustomers">0</div></div>
<div class="kpi-card pink"><div class="kpi-label">Branches</div><div class="kpi-value" id="totalBranches">0</div></div>
<div class="kpi-card orange"><div class="kpi-label">Avg Revenue</div><div class="kpi-value" id="avgRevenue">â‚¹0</div></div>
</div>

<!-- ================= EXISTING CHART PLACEHOLDER ================= -->
<div class="charts-grid">
<div class="chart-card full-width">
<div class="chart-title">Branch-wise Quarter Comparison (FY 2025-26)</div>
<div class="chart-container tall"><canvas id="quarterChart"></canvas></div>
</div>

<!-- ================= NEW QUARTER X vs Y ================= -->
<div class="chart-card full-width">
<div class="chart-title">Branch-wise Quarter Comparison (Quarter X vs Quarter Y)</div>

<div class="filters">
<div class="filter-group">
<label>Quarter X</label>
<select id="quarterX" onchange="updateQuarterXYChart()">
<option value="Q1">Q1 (Apr25-Jun25)</option>
<option value="Q2">Q2 (Jul25-Sep25)</option>
<option value="Q3">Q3 (Oct25-Dec25)</option>
<option value="Q4">Q4 (Jan26-Mar26)</option>
</select>
</div>

<div class="filter-group">
<label>Quarter Y</label>
<select id="quarterY" onchange="updateQuarterXYChart()">
<option value="Q2">Q2 (Jul25-Sep25)</option>
<option value="Q1">Q1 (Apr25-Jun25)</option>
<option value="Q3">Q3 (Oct25-Dec25)</option>
<option value="Q4">Q4 (Jan26-Mar26)</option>
</select>
</div>
</div>

<div id="quarterXYError" class="error" style="display:none">
Select Different Quarter Period from Quarter X & Quarter Y
</div>

<div class="chart-container tall" id="quarterXYContainer">
<canvas id="quarterXYChart"></canvas>
</div>
</div>
</div>
</div>

<script>
/* ================= DATA LOAD ================= */
let rawData=[];
let quarterXYChart=null;

fetch('SALESMIS.csv')
.then(r=>r.text())
.then(t=>{
Papa.parse(t,{
header:true,skipEmptyLines:true,
complete:(res)=>{
rawData=res.data;
init();
}});
});

function init(){
updateKPIs();
updateQuarterXYChart();
}

/* ================= KPI ================= */
function updateKPIs(){
let revenue=0;
rawData.forEach(r=>{
Object.keys(r).forEach(k=>{
if(k.includes('-')){
let v=parseFloat(String(r[k]||'0').replace(/,/g,''));
revenue+=isNaN(v)?0:v;
}
});
});
document.getElementById('totalRevenue').innerText='â‚¹'+revenue.toLocaleString('en-IN');
document.getElementById('totalCustomers').innerText=new Set(rawData.map(d=>d.Party_no)).size;
document.getElementById('totalBranches').innerText=new Set(rawData.map(d=>d.Branch)).size;
document.getElementById('avgRevenue').innerText='â‚¹'+Math.round(revenue/Math.max(1,new Set(rawData.map(d=>d.Party_no)).size)).toLocaleString('en-IN');
}

/* ================= QUARTER X vs Y ================= */
const QM={
Q1:['Apr-25','May-25','Jun-25'],
Q2:['Jul-25','Aug-25','Sep-25'],
Q3:['Oct-25','Nov-25','Dec-25'],
Q4:['Jan-26','Feb-26','Mar-26']
};

function updateQuarterXYChart(){
const qx=document.getElementById('quarterX').value;
const qy=document.getElementById('quarterY').value;
const err=document.getElementById('quarterXYError');
const cont=document.getElementById('quarterXYContainer');

if(qx===qy){
err.style.display='block';
cont.style.display='none';
if(quarterXYChart) quarterXYChart.destroy();
return;
}
err.style.display='none';
cont.style.display='block';

let branch={};
rawData.forEach(r=>{
let b=r.Branch;
if(!b) return;
if(!branch[b]) branch[b]={x:0,y:0};
QM[qx].forEach(m=>{
let v=parseFloat(String(r[m]||'0').replace(/,/g,''));
branch[b].x+=isNaN(v)?0:v;
});
QM[qy].forEach(m=>{
let v=parseFloat(String(r[m]||'0').replace(/,/g,''));
branch[b].y+=isNaN(v)?0:v;
});
});

let labels=Object.keys(branch);
let dx=labels.map(b=>branch[b].x/100000);
let dy=labels.map(b=>branch[b].y/100000);

if(quarterXYChart) quarterXYChart.destroy();
quarterXYChart=new Chart(document.getElementById('quarterXYChart'),{
type:'bar',
data:{
labels,
datasets:[
{label:qx,data:dx,backgroundColor:'#3b82f6'},
{label:qy,data:dy,backgroundColor:'#ec4899'}
]},
options:{
responsive:true,
plugins:{
tooltip:{callbacks:{
label:c=>`${c.dataset.label}: ${c.parsed.y.toFixed(1)} L (â‚¹${(c.parsed.y*100000).toLocaleString('en-IN')})`
}},
legend:{labels:{color:'#94a3b8'}}
},
scales:{
y:{beginAtZero:true,ticks:{callback:v=>v+' L',color:'#94a3b8'}},
x:{ticks:{color:'#94a3b8'}}
}
}
});
}
</script>

</body>
</html>
